# Блог на Yii2
Блог на Yii версии 2.  

# Как запустить
Установите все нужные пакеты:
```
composer install && composer update
```

Инициализируйте приложение:
```
./init
```
  
После этого создадутся файлы с конфигурацией приложения.
  
Создайте БД и в файле `common/config/main-local.php` в строке `dsn` внесите название вашей БД.

Накатите миграции:
```
yes | ./yii migrate
```

Т.к. функций создания сущностей не предусмотрено, то все сущности накатываются из тестовых фикстур.  
Накатите фикстуры:  
```
yes | ./yii fixture/load "*"
```

# Что есть
Предусмотрены следующие страницы:
- `post/index` - страница с постами. Есть кнопка для подгрузки следующих постов.  
- `post/view&id=1` - страница просмотра поста. К посту прилагаются комментарии.  
  
Также предусмотрено два api-метода:
- `post/list` - возвращает списка постов. Используется при ajax-подгрузке на странице `post/index`.
  Входные параметры: 
  * __amount__ - количество постов.
  * __lastId__ - id последнего поста на странице. Используется вместо offset (см. линк ниже).
- `post/author-comments` - список авторов, оставивших комментарии к посту.
  Входные параметры:
  * __postId__ - id поста.
  
Возвращаемый массив в обоих методах:
```json
{
    "success": "true",
    "data": ["массив с данными"],
    "errorMessage": null
}
```
В случае ошибки:
```json
{
    "success": "true",
    "data": null,
    "errorMessage": "описание возникшей ошибки"
}
```

Возвращаемый массив в методе получения списка авторов, поставивших комментарий:
```json
{
    "success": "true",
    "data": [
        {
            "amountOfComments": 1,
            "author": {
                "id": 1,
                "username": "denchik_1i2",
                "email": "denchik@mail.ru",
                "другие поля": "..."
            }
        },
        {
            "amountOfComments": 3,
            "author": {
                "id": 2,
                "username": "fuhg4",
                "email": "fuhg4@rambler.ru",
                "другие поля": "..."
            }
        }
    ],
    "errorMessage": "описание возникшей ошибки"
}
```

# Тесты
Накатите миграции с фикстурами:  
```
yes | ./yii_test migrate
yes | ./yii_test fixture/load "*"
```
Также нужно установить url-адреса в функциональных и acceptance-тестах.  
Это делается путём редактирования файлов `frontend/config/functional.yml` и `frontend/config/acceptance.yml`.  
Замените в данных файлах url на нужный адрес.  